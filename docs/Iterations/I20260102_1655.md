 âœ… Committed! 3Dâ†’2D Outline Extraction Implemented

  Commits:
  1. 53b14b6 - chore: add room stitching reference image and update iOS dependencies
  2. af4be23 - feat: implement 3Dâ†’2D mesh projection for real room outline extraction

  ğŸ¯ What Was Implemented:

  Native iOS Layer (SceneKit):
  - ios/Runner/RoomOutlineExtractor.swift - Complete mesh projection algorithm:
    - Loads USDZ/GLB files via SceneKit
    - Extracts all geometry vertices in world space
    - Finds floor vertices (minY + 5cm threshold)
    - Projects to XZ plane (ground projection)
    - Computes convex hull (Graham scan algorithm)
    - Simplifies polygon (Ramer-Douglas-Peucker)
    - Returns 2D coordinate array to Flutter

  Platform Channel:
  - ios/Runner/AppDelegate.swift - Method channel: com.vron.mobile/outline_extractor
  - Background thread processing to avoid UI blocking

  Flutter Layer:
  - lib/features/scanning/services/room_outline_extraction_service.dart:
    - Async outline extraction per scan
    - Fallback to placeholder if extraction fails
    - Scaling: 1 meter = 100 pixels
    - Automatic centering around origin
  - lib/features/scanning/screens/room_layout_canvas_screen.dart:
    - Async initialization with loading indicator
    - Real outline rendering instead of placeholders

  ğŸ“‹ IMPORTANT: Manual Setup Step Required

  The Swift file needs to be added to the Xcode project:

  # 1. Open Xcode workspace
  open ios/Runner.xcworkspace

  # 2. In Xcode:
  #    - Right-click "Runner" folder in left sidebar
  #    - Select "Add Files to Runner..."
  #    - Navigate to ios/Runner/RoomOutlineExtractor.swift
  #    - âœ… Ensure "Runner" target is checked
  #    - âŒ UNCHECK "Copy items if needed" (file is already there)
  #    - Click "Add"

  # 3. Build and run:
  flutter run -d 00008140-0005185602DB001C --debug

  ğŸ”¬ Algorithm Details:

  1. Load 3D Model â†’ SceneKit SCNScene
  2. Traverse Nodes â†’ Extract geometry vertices
  3. Transform â†’ World space coordinates
  4. Filter Floor â†’ y <= minY + 0.05m (5cm threshold)
  5. Project 2D â†’ (x, z) coordinates only
  6. Convex Hull â†’ Graham scan O(n log n)
  7. Simplify â†’ Ramer-Douglas-Peucker (0.05m tolerance)
  8. Scale â†’ 1m = 100px for canvas
  9. Center â†’ Around origin for rotation

  ğŸ¨ Expected Behavior After Setup:

  1. Tap "Room stitching" â†’ Loading screen appears
  2. "Extracting room outlines... Analyzing X scan(s)" message
  3. Real room shapes render on canvas (not rectangles!)
  4. Each room shows actual floor plan outline from 3D scan
  5. Processing time: ~100-500ms per scan

  ğŸš€ Next Steps:

  - Add the Swift file to Xcode (instructions above)
  - Test with real USDZ scan files
  - Verify outlines match actual room shapes
  - Iterate on epsilon threshold if needed (currently 5cm)
  - Future: Implement concave hull for better accuracy

