Now I have a complete picture of all the issues. Let me provide you with a comprehensive solution document:

  CI/CD Pipeline Fix - Complete Solution

  âœ… Fixed Issues:

  1. Added Missing Dependencies to pubspec.yaml:
    - Added flutter_json_view: ^1.1.4
    - Added package_info_plus: ^8.1.2
    - Uncommented integration_test (SDK dependency)
  2. build_info.dart file already exists - The file is present but CI needs to generate it

  ðŸ”´ Remaining Issues (33 errors):

  Category 1: Integration Test - Missing Imports (3 errors)

  File: integration_test/combine_scan_flow_test.dart

  Problem: Missing Flutter imports
  // Missing at top of file:
  import 'package:flutter/material.dart';

  Lines 52, 199, 233 reference LinearProgressIndicator, Icons, and Container without importing Flutter.

  Fix: Add import at the top of the file.

  ---
  Category 2: ExportCombinedDialog Test - Wrong API (24 errors)

  File: test/features/scanning/widgets/export_combined_dialog_test.dart

  Problem: Test uses outdated widget API. The actual widget changed from:
  // OLD (what test expects):
  ExportCombinedDialog(
    combinedGlbSize: 12582912,
    navmeshSize: 1048576,
    onExportCombinedGlb: () {},
    ...
  )

  To:
  // NEW (actual widget):
  ExportCombinedDialog(
    combinedScan: scan,  // Gets file sizes internally
    onExportGlb: () {},  // Renamed parameter
    onExportNavmesh: () {},
    onExportBoth: () {},
    onClose: () {},
  )

  Fix: The widget now:
  - Calculates file sizes internally from the CombinedScan object
  - Uses onExportGlb instead of onExportCombinedGlb
  - Added onClose callback

  Update all test cases to use the new API signature.

  ---
  Category 3: File Upload Service Test - Wrong Mock Syntax (6 errors)

  File: test/features/scanning/services/file_upload_service_test.dart

  Problem: Using when() with async functions incorrectly (lines 32, 57, 78, 98, 112, 132)

  Current (wrong):
  when(() => mockFilePicker.pickFiles(type: FileType.any))

  Should be:
  when(() => mockFilePicker.pickFiles(type: FileType.any)).thenAnswer((_) async => mockResult)

  Mocktail requires .thenAnswer() for async methods.

  ---
  Category 4: Invalid Constant Value (1 error)

  File: lib/features/scanning/screens/stitched_model_preview_screen.dart:27

  Problem: Invalid constant value (need to see specific line to diagnose)

  ---
  Category 5: Test Helper Null Safety (1 error)

  File: test/test_helpers.dart:16

  Problem: Calling .initialize() on potentially null receiver

  Fix: Add null check:
  // Before:
  something?.initialize()

  // After:
  await something?.initialize()
  // OR
  if (something != null) {
    something.initialize();
  }

  ---
  ðŸ“‹ CI/CD Workflow Fix

  Your CI/CD pipeline needs to generate build_info.dart before running flutter analyze. Add this step:

  # In your .github/workflows/*.yml or CI config:

  - name: Generate build info
    run: ./scripts/generate_build_info.sh

  - name: Get dependencies
    run: flutter pub get

  - name: Analyze code
    run: flutter analyze

  ---
  ðŸŽ¯ Summary by Priority:

  High Priority (Breaks CI):
  1. âœ… DONE: Add missing dependencies
  2. âœ… DONE: Uncomment integration_test
  3. TODO: Add flutter/material.dart import to integration_test/combine_scan_flow_test.dart
  4. TODO: Update ExportCombinedDialog test API (24 test methods across 8 test cases)
  5. TODO: Fix File upload service mock syntax (6 locations)
  6. TODO: Add build_info.dart generation step to CI/CD workflow

  Medium Priority (Test quality):
  7. Fix stitched_model_preview_screen.dart invalid constant
  8. Fix test_helpers.dart null safety issue

  Low Priority (Code quality - info/warnings):
  - 6 warnings about unused fields/variables
  - ~100 info messages about print statements in production code
  - Some deprecation warnings (encryptedSharedPreferences, Share.shareXFiles)

  ---
  Would you like me to:
  1. Fix all the test files now (I can update them programmatically)
  2. Create a CI/CD workflow file with the proper build steps
  3. Just commit what we have so far (dependencies fix) and handle tests separately

  Let me know which approach you prefer!

