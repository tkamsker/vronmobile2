Coverage Summary Table

  | Requirement Key                | Has Task?  | Task IDs             | Notes                            |
  |--------------------------------|------------|----------------------|----------------------------------|
  | FR-001 (select 2+ scans)       | ✅ Yes     | T040-T046            | Covered by screen initialization |
  | FR-002 (disable <2 scans)      | ✅ Yes     | T046                 | Button validation logic          |
  | FR-003 (block guest users)     | ✅ Yes     | T105                 | Integration test scenario        |
  | FR-004 (upload USDZ files)     | ✅ Yes     | T099                 | Backend service integration      |
  | FR-005 (poll job status)       | ✅ Yes     | Existing             | Original implementation          |
  | FR-006 (display stages)        | ✅ Yes     | Existing             | Original implementation          |
  | FR-007 (show progress %)       | ✅ Yes     | Existing             | Original implementation          |
  | FR-008 (download model)        | ✅ Yes     | Existing             | Original implementation          |
  | FR-009 (navigate to preview)   | ✅ Yes     | Existing             | Original implementation          |
  | FR-010 (error dialog)          | ✅ Yes     | T128-T130            | Error handling tasks             |
  | FR-011 (retry option)          | ✅ Yes     | Existing             | Original implementation          |
  | FR-012 (timeout handling)      | ✅ Yes     | Existing             | Original implementation          |
  | FR-013 (pass room names)       | ✅ Yes     | T096                 | Metadata serialization           |
  | FR-014 (AR viewer)             | ✅ Yes     | Existing             | Original implementation          |
  | FR-015 (export GLB)            | ✅ Yes     | Existing             | Original implementation          |
  | FR-016 (save to project)       | ✅ Yes     | Existing             | Original implementation          |
  | FR-017 (preserve scans)        | ✅ Yes     | Existing             | Session management               |
  | FR-018 (render canvas)         | ✅ Yes     | T035-T045            | Canvas rendering tasks           |
  | FR-019 (extract outline)       | ✅ Yes     | T028-T030, T100-T102 | Outline extraction service       |
  | FR-020 (color cycling)         | ✅ Yes     | T037                 | Room outline layer rendering     |
  | FR-021 (display room name)     | ✅ Yes     | T039, T092-T093      | Label layer rendering            |
  | FR-022 (estimate doors)        | ✅ Yes     | T031-T034, T043      | Door detection service           |
  | FR-023 (single-selection)      | ✅ Yes     | T050-T054            | Selection interaction            |
  | FR-024 (visual selection)      | ✅ Yes     | T054                 | Selection layer rendering        |
  | FR-025 (enable buttons)        | ✅ Yes     | T055-T057            | Toolbar state management         |
  | FR-026 (drag to move)          | ✅ Yes     | T066-T067            | Pan gesture handling             |
  | FR-027 (rotate by config)      | ✅ Yes     | T068-T071            | Rotation logic                   |
  | FR-028 (.env config)           | ⚠️ PARTIAL | T010                 | C4: Missing fallback logic task  |
  | FR-029 (canvas bounds)         | ✅ Yes     | T072                 | Bounds checking                  |
  | FR-030 (update door positions) | ✅ Yes     | T070                 | Door transform on rotate         |
  | FR-031 (manual door placement) | ✅ Yes     | T080-T082            | Door placement interaction       |
  | FR-032 (door suggestions)      | ✅ Yes     | T083-T084            | Connection suggestion logic      |
  | FR-033 (confirm connections)   | ✅ Yes     | T086-T087            | Connection confirmation          |
  | FR-034 (include door metadata) | ✅ Yes     | T094-T096            | Metadata serialization           |
  | FR-035 (persist layout config) | ⚠️ PARTIAL | T102                 | C5: No explicit persistence task |
  | FR-036 (door action menu)      | ✅ Yes     | T088-T090            | DoorActionMenu widget            |

  Coverage Statistics:
  - Total Functional Requirements: 36
  - Requirements with Tasks: 34 (94.4%)
  - Requirements Partially Covered: 2 (5.6%)
  - Requirements with Zero Coverage: 0 (0%)

  ---
  Constitution Alignment Issues

  ❌ Critical Constitution Violations

  Constitution Principle I (Test-First Development):
  - Status: ✅ COMPLIANT
  - Evidence: Tasks explicitly follow TDD pattern (T013-T020 are test tasks marked "write FIRST", T021+ are implementation). Strong emphasis on test-first approach.

  Constitution Principle II (Simplicity & YAGNI):
  - Status: ✅ COMPLIANT
  - Evidence: Plan.md:409-411 explicitly states no premature abstractions, no over-engineering. Implementation matches spec requirements without hypothetical features.

  Constitution Principle III (Platform-Native Patterns):
  - Status: ✅ COMPLIANT
  - Evidence: Uses Flutter CustomPainter, feature-based architecture, Material widgets. Plan.md:118-128 documents Flutter patterns.

  Documentation Requirements (Constitution Governance Section):
  - Status: ⚠️ PARTIAL VIOLATION - Issue C3
  - Missing: research.md, data-model.md, contracts/ directory
  - Impact: Cannot validate algorithm choices, data model clarity, or API contracts before implementation
  - Recommendation: Run /speckit.specify for data-model.md, create research.md documenting 3D parsing library evaluation

  ✅ Constitution Compliance Highlights

  - Security: Uses HTTPS, validates guest mode (FR-003), sanitizes file paths (plan.md:136)
  - Performance: Specific measurable goals (< 500ms extraction, 60fps rendering)
  - Accessibility: Plan.md:155-161 documents semantic labels, touch targets, screen reader support (T115-T119)
  - CI/CD: Feature branch 017-room-stitching, TDD enforced, code review required (plan.md:162-170)

  ---
  Unmapped Tasks

  Tasks with No Clear Requirement Mapping:

  | Task ID   | Description                              | Issue                                                                 |
  |-----------|------------------------------------------|-----------------------------------------------------------------------|
  | T007      | Load .env in main.dart                   | Not a violation - infrastructure setup task without direct FR mapping |
  | T012      | Verify existing ScanSessionManager       | Setup verification task - acceptable                                  |
  | T120-T135 | Polish tasks (comments, docs, profiling) | Cross-cutting concerns - no specific FR required                      |

  Assessment: All unmapped tasks are legitimate infrastructure/polish work. No orphaned feature tasks detected.

  ---
  Metrics

  - Total Functional Requirements: 36
  - Total User Stories: 8 (US1-US4 existing, US5-US8 new)
  - Total Tasks: 135
    - Test Tasks: 42 (31%)
    - Implementation Tasks: 93 (69%)
  - Tasks with [P] Parallel Marker: 58 (43%)
  - Coverage Percentage: 94.4% (34/36 requirements fully covered)
  - Ambiguity Count: 7 (4 HIGH, 3 LOW)
  - Duplication Count: 2 (both HIGH)
  - Inconsistency Count: 3 (all MEDIUM)
  - Critical Issues: 5
  - High Severity Issues: 8
  - Medium Severity Issues: 7
  - Low Severity Issues: 4

  ---
  Next Actions

  ⚠️ CRITICAL - Must Resolve Before Implementation

  1. C1/C2: Research 3D Parsing Library (2-3 days)
    - Evaluate model_3d package viability for USDZ/GLB parsing
    - Test with real scan files from Feature 014-lidar-scanning
    - If model_3d insufficient, design custom USDZ parser (adds 5-7 days)
    - Document findings in research.md
    - Update plan.md dependencies with specific chosen library
  2. C3: Generate Missing Documentation (1 day)
    - Run /speckit.specify to create data-model.md from spec Key Entities
    - Create research.md documenting 3D parsing algorithm research
    - Create contracts/ directory with GraphQL schema for layout metadata
  3. C4: Add .env Fallback Task (add to tasks.md)
  - [ ] T006b Implement .env validation and fallback defaults in CanvasConfiguration.fromEnv() - throw warning if ROOM_ROTATION_DEGREES missing, use 45° default
  4. C5: Add Layout Persistence Task (add to tasks.md after T101)
  - [ ] T101b Implement layout configuration persistence in ScanData.metadata['layoutConfig'] with JSON serialization/deserialization
  5. Resolve Ambiguities A1-A4:
    - Define door detection accuracy measurement method (A2)
    - Document outline extraction algorithm choice and rationale (A3)
    - Add door detection confidence threshold to FR-022 (A4)

  Recommended Before Phase 3 (User Story 5)

  6. Address Duplications D1-D2: Consolidate requirement phrasing between spec requirements and user story acceptance criteria
  7. Resolve Inconsistencies I1-I3:
    - Add RoomLayoutConfiguration to spec Key Entities
    - Document RoomStitchingScreen refactor/replace strategy
    - Clarify room names vs layout config separation in RoomStitchRequest
  8. Standardize Terminology T1-T2: Add glossary to spec.md defining "room outline" vs "outline edges" vs "room border"

  Optional Improvements (Can Proceed)

  9. Address LOW severity issues N1-N4: These are minor quality improvements that don't block implementation
  10. Add Missing Test: Layout persistence test (N2) - add to Phase 8 integration test tasks

  ---
  Risk Assessment

  HIGH RISK - Requires Mitigation:
  - ⚠️ 3D Parsing Uncertainty (C1/C2): Entire canvas feature depends on ability to extract 2D outlines from USDZ files. If parsing fails, fallback to bounding box (Option C) severely degrades user experience.
    - Mitigation: Allocate 2-3 days upfront for parsing proof-of-concept before committing to Phase 3 implementation

  MEDIUM RISK - Monitor:
  - ⚠️ Door Detection Accuracy (A2): 70% target may be difficult to achieve without machine learning. Manual door placement (US8) provides fallback, but poor auto-detection frustrates users.
    - Mitigation: Implement US8 (manual doors) early. Consider lowering accuracy expectation to 50-60% in SC-012.

  LOW RISK:
  - Documentation gaps (C3) are addressable in 1 day
  - Missing tasks (C4/C5) are small additions
  - Ambiguities and inconsistencies are quality issues, not blockers

  ---
  Would you like me to suggest concrete remediation edits for the top issues?

  I can provide specific diff-style edits for:
  1. Adding missing tasks C4 and C5 to tasks.md
  2. Creating research.md skeleton with 3D parsing evaluation criteria
  3. Updating spec.md to add RoomLayoutConfiguration to Key Entities
  4. Adding door detection confidence threshold to FR-022

  These edits would address 4 of the 5 CRITICAL issues (C3, C4, C5, and partially C1/C2). However, you would still need to conduct the 3D parsing library research before proceeding with implementation.

  Todos
  ☒ Create .xcode-version file to pin Xcode 16.4
  ☒ Update Podfile with Xcode 16.4 documentation
  ☐ Update CI/CD workflow to use Xcode 16.4
  ☐ Verify Xcode version configuration

